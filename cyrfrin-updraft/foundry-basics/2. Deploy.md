# Deploy a Smart Contract Locally Using Anvil via Scripts

## Why Use Deployment Scripts?

- Provides a consistent, repeatable, and reliable way to deploy smart contracts.
- Enhances testing of deployment processes and contract code.
- Scripting in Foundry uses Solidity itself, leveraging Foundry’s extended tooling.

## Foundry Script Basics

- Scripts are stored in the `script` folder.
- Foundry script filenames use the `.s.sol` suffix (e.g., `DeploySimpleStorage.s.sol`).
- Foundry tests will use `.t.sol` suffix in later lessons.
- More best practices: [Foundry Scripts Guide](https://book.getfoundry.sh/guides/best-practices#scripts).

## Writing the Deployment Script

### Initial script setup:

```solidity
// SPDX-License-Identifier: MIT
pragma solidity 0.8.19;
import {Script} from "forge-std/Script.sol";
import {SimpleStorage} from "../src/SimpleStorage.sol";

contract DeploySimpleStorage is Script {

    function run() external returns (SimpleStorage) {
        vm.startBroadcast();
        SimpleStorage simpleStorage = new SimpleStorage();
        vm.stopBroadcast();
    }

}
```

- The run function is called by forge script.

1. vm is Foundry’s cheat code interface.
2. vm.startBroadcast() marks the transaction list start to send to RPC URL.
3. vm.stopBroadcast() marks the end.
4. Contract deployed inside these calls.

## Running the Script Locally with Anvil
- Stop the running Anvil instance (Ctrl/Cmd + C).
- Run the script without RPC URL (auto-launches Anvil):
```bash
forge script script/DeploySimpleStorage.s.sol 
```
- Output shows successful compilation and deployment.
- Without RPC URL, Foundry runs an Anvil instance temporarily.

## Running Script with Explicit RPC URL
1. Start Anvil in one terminal:
```bash
anvil
```

2. In another terminal, run script with RPC URL:
```bash
forge script script/DeploySimpleStorage.s.sol --rpc-url http://127.0.0.1:8545
```
- Output indicates simulation, new broadcast folder created with script run info.

3. To actually broadcast deployment, add:
```bash
--broadcast --private-key 0xac0974bec39a17e36ba4a6b4d238ff944bacb478cbed5efcae784d7bf4f2ff80
```
- View anvil terminal for transaction and deployment details.