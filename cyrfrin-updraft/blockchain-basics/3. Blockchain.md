# Blockchain Working

## What is a Hash?
A hash is a unique, fixed-length string that identifies any piece of data. When data is input into a hash function, it produces a hash.

### Example: SHA-256 Algorithm
- Input: `patrick collins`
- Process:
    1. Converts the letters to numbers.
    2. Converts the numbers to a fixed-length "string" or "hash."
- Output: `7esbsalacbgee2908b534dd5728a998173d502469c37121dd63fca283068077c`

### Ethereum's Hashing Algorithm
- Ethereum uses **Keccak256**, which is similar to SHA-256 but belongs to the same SHA family.
- The length of the hash remains constant regardless of input size.

## Understanding Blocks

### What is a Block?
A block contains:
- **Block number**
- **Nonce**: A value adjusted during mining to produce a valid hash.
- **Data**: The input data for the block.

All these components are processed through the hash algorithm to produce the block's unique hash.

### Mining and Nonce
- Mining involves finding a nonce value that produces a hash satisfying a specific criterion (e.g., starting with four zeros).
- The criteria vary across blockchains, but the core concept remains consistent.

## Immutability of Blockchain

### How it Works
- Each block contains:
    - Block number
    - Nonce
    - Data
    - Hash of the previous block
- **Effect of Changes**:
    - Any change in data invalidates all subsequent blocks until they are re-mined.

### Genesis Block
- The first block in a blockchain is called the **Genesis Block**.

## Decentralized Distribution

### Why Decentralization Matters
- In a centralized blockchain, a single entity could modify data and re-mine subsequent blocks, undermining trust.
- **Decentralization** prevents this by:
    - Having multiple peers (nodes) run the blockchain.
    - Ensuring that the majority hash (agreed upon by most nodes) wins.

### Forking
- Nodes that disagree with the majority hash fork the network and continue with their own history.

## Blockchain and Transactions
- Data in blocks can represent anything, such as transactions.
- All transactions in a block are hashed together.
- Any edit to a transaction invalidates the chain.

## Blockchain Networks:
- Operate through decentralized nodes. A **node** is a single instance of a decentralized system.
- Anyone can run a node by setting up hardware and joining the network.
- If one or several nodes go down, the system persists as long as at least one node is operational.
- Popular blockchains like Bitcoin and Ethereum have thousands of nodes, ensuring redundancy and security.
- Malicious nodes are either removed from the network or punished.

**Key Benefit:**
- Immutability: Blockchain functions as a decentralized database. Ethereum adds computation to this decentralized system.

## Consensus

### Definition:
Consensus is the mechanism used to agree on the state or a single value of the blockchain in a decentralized system.

### Components of a Consensus Protocol:
1. **Chain Selection Algorithm**: Determines the valid blockchain (e.g., longest chain rule).
2. **Sybil Resistance Mechanism**: Prevents users from creating many pseudo-anonymous identities to manipulate the network.

## Proof of Work (PoW)

### How It Works:
- Miners solve computationally heavy problems ("mining") to validate blocks.
- Mining difficulty adjusts block time by making block answers harder or easier.

### Characteristics:
- **Sybil Resistance:** Each node must do the computational work, keeping the playing field fair.
- **Chain Selection Rule:** The longest chain rule determines the valid chain.
- **Rewards:** Miners earn:
    - Transaction fees from the block.
    - Block rewards in native cryptocurrency (e.g., BTC, ETH).
    - Bitcoin's block reward reduces every ~4 years (Bitcoin Halving).

### Drawbacks:
- High energy consumption due to the computational intensity of mining.

## Proof of Stake (PoS)

### How It Works:
- Validators stake collateral to behave honestly.
- Misbehaving validators lose their stake (slashing).

### Characteristics:
- Validators are pseudo-randomly chosen to propose the next block.
- Other nodes validate the proposed block.
- No computational race as in PoW, leading to lower energy consumption.

### Pros:
- Great Sybil resistance.
- Environmentally friendly.

### Cons:
- Higher upfront staking costs may reduce decentralization.

## Blockchain Vulnerabilities:

### Sybil Attacks
- Attack where one entity creates many fake nodes to gain majority control.
- Allows fraudulent transactions, double-spending, transaction censorship, reordering, and rewriting blockchain history.
- Major blockchains defend via:
  - PoW: Security through computational power, making it expensive.
  - PoS: Security through economic stake, requiring locking large cryptocurrency.
  - https://www.cyfrin.io/blog/understanding-sybil-attacks-in-blockchain-and-smart-contracts
  - https://www.cyfrin.io/blog/understanding-double-spending-in-blockchain

### 51% Attack
- Malicious actor gains over 50% of consensus power.
- PoW: Controls majority hash rate, can rewrite chain history and double-spend.
- PoS: Controls majority stake, can manipulate fork choice but finality requires ≥67% stake.
- Costly and likely thwarted by social consensus hard forks.

### Blockchain Reorganization (Re-orgs)
- Happens naturally when two miners find valid blocks simultaneously.
- Confirmations prevent transaction undoing in PoW.
- PoS uses finality to prevent malicious re-orgs.

### MEV and Sandwich Attacks
- Maximal Extractable Value (MEV): Profiting by reordering transactions.
- Sandwich attack exploits mempool transaction order:
  1. Bot front-runs user’s large buy order.
  2. User pays higher price; bot profits by back-running sell.

### Bugs in Client Software
- Vulnerabilities may stem from bugs, e.g., 2010 Bitcoin bug causing overflow creating billions of BTC.
- Community response: bug fix and hard fork rollback.

### Replay Attacks
- Valid transactions replayed on different but compatible blockchains.
- Prevented by:
  - Chain ID unique to each blockchain.
  - Nonce ensures uniqueness per transaction.
  - https://www.cyfrin.io/blog/replay-attack-in-ethereum

### Why Major Blockchains Remain Secure
- Attacks are economically irrational.
- Honest participation is more profitable than cheating.
- Smaller blockchains are more vulnerable due to lower cost of attacks.
