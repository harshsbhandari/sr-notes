# Blockchain Layers

## Layer 1 (L1)
A **Layer 1 blockchain** is the base layer of the blockchain ecosystem, where nodes help the chain reach consensus. 
It operates without additional plugins and is often referred to as the **settlement layer**. Examples of L1 blockchains include:

- **Bitcoin**
- **BNB Chain**
- **Solana**
- **Avalanche**

In this course, we focus primarily on **Ethereum**, which serves as the hub of the Ethereum ecosystem. 
Applications directly deployed on Ethereum, such as **Uniswap**, are not considered L2s but rather **dApps on L1**.

## Layer 2 (L2)
A **Layer 2** is any application built outside an L1 blockchain that hooks back into it. Different types of L2s include:

- **Decentralized Oracle Networks** (e.g., Chainlink)
- **Event Indexing Networks** (e.g., The Graph)

The most popular type of L2, however, is the **rollup** or L2 chain.

## Rollups
**Rollups** are L2 scaling solutions that increase the number of transactions on Ethereum by bundling multiple transactions into one, reducing gas costs. 
They address the **blockchain trilemma**, which states that a blockchain can only achieve two out of three properties:

1. **Decentralization**
2. **Security**
3. **Scalability**

Ethereum sacrifices **scalability**, as it can only process approximately **15 transactions per second**. 
Rollups aim to enhance scalability without compromising security or decentralization.

## How Rollups Work
1. A user submits a transaction to the rollup.
2. An **operator** (a node or entity responsible for processing transactions):
   - Picks up the transaction.
   - Bundles it with other transactions.
   - Compresses them.
   - Submits the batch back to the L1 blockchain.
3. Gas costs associated with the transaction are split among all users in the batch.

## Types of Rollups
There are two main types of rollups:

### Optimistic Rollups
- Assume that off-chain transactions are valid by default.
- **Operators** propose the valid state of the rollup chain.
- During a **challenge period**, other operators can challenge potentially fraudulent transactions by computing a **fraud proof**.

**Fraud Proof Process**:
- Operators engage in a call-and-response interaction to identify and isolate a specific computational step.
- This step is executed on the L1 blockchain. If the result differs from the original state, the transaction is deemed fraudulent.
- When fraud proof succeeds:
  - The rollup re-executes the entire batch of transactions correctly.
  - The responsible operator is penalized, typically through **slashing** (loss of staked tokens).

### Zero-Knowledge (ZK) Rollups
- Use **validity proofs** (zk proofs) to verify transaction batches.
- The **prover** (operator) generates a zk proof to show that their inputs (transactions) satisfy the required equation.
- A **verifier** (an L1 contract) checks this proof to ensure that the output matches the expected result.
- The **witness** refers to the solution the prover uses to demonstrate that their input satisfies the mathematical equation.

--

# Rollup Stages and zkSync Risk Analysis

## Introduction
A Layer 2 (L2) chain's maturity is evaluated based on specific properties and categorized into stages. 
The L2Beat (L2B) team provides an opinionated assessment to encourage a progression towards greater decentralization.

## Rollup Stages

### Stage 0
- Governance is largely in the hands of the operators and a security council, ensuring critical decisions and actions are overseen by a trusted group.
- Open-source software allows for the reconstruction of the state from L1 data, ensuring transparency and accessibility.
- Users have an exit mechanism that allows them to leave the rollup within seven days. However, this often requires actions from an entity/operator.

### Stage 1
- Governance evolves to be managed by smart contracts, while the security council still plays an important role (e.g., solving bugs).
- The proof system becomes fully functional, enabling decentralized submission of validity proofs.
- Exit mechanism is improved, allowing users to exit independently without needing operator coordination.

### Stage 2
- Rollup achieves full decentralization with governance entirely managed by smart contracts, removing the need for operators or council interventions in everyday operations.
- The proof system becomes permissionless.
- Exit mechanism is fully decentralized.
- Security council's role is strictly limited to addressing any errors that occur on-chain, ensuring fairness without reliance on centralized entities.

## zkSync Risk Analysis
In the L2Beat summary, it's possible to see the actual stage of each rollup. Currently, zkSync Era is operating as a Stage 0 rollup. Below is the risk analysis:

### Data Availability
- Refers to the ability to reconstruct the L2 state from L1 data, ensuring anyone can verify and rebuild the L2 state if necessary.

### State Validation
- Verifies the legitimacy of a set of bundled transactions.
- For zkSync, this is done using zero-knowledge proofs through an algorithm known as **PLONK** 
(Permutations over Lagrange-bases for Oecumenical Noninteractive arguments of Knowledge).

### Sequencer Failure
- Describes the ability to process transactions even if the sequencer is down.
- In zkSync, transactions can still be submitted to L1, though not necessarily enforced immediately.
- **Note:** The sequencer is the operator responsible for ordering user transactions and batching them before committing them to Layer 1.

### Proposer Failure
- Describes the ability to process transactions even if the proposer is down.
- In this case, zkSync will halt all withdrawals and transaction executions.

### Exit Window
- In the current zkSync stage, there is no window for exit during unwanted upgrades.

--

# Introduction
In blockchain and cryptocurrency networks, the role of a sequencer is crucial for ordering and bundling transactions. 
Sequencers are operators responsible for organizing how transactions are processed. 
In many roll-up solutions, sequencers are centralized, controlled by a single entity.

# Centralization Risks
1. Censorship and Manipulation
- Centralized sequencers have the power to selectively block or delay specific transactions.
- Example: Users might experience blocked withdrawal transactions, preventing them from accessing their funds.
- Centralized control enables the manipulation of transaction order for personal gain.

2. Operational Downtime
- If a centralized sequencer experiences downtime, all transaction processing can halt.
- Consequence: No transactions, including withdrawals, can be processed until the sequencer is back online.
